# Знакомство с облачной инфраструктурой и облачными сервисами
Домашняя работа №3

## Задание
1. [IP адресация](#chapter-0)
2. [Настроить доступ по SSH](#chapter-1)
3. [Настроить доступ через VPN](#chapter-2)

<a id="chapter-0"></a>
## IP адресация

bastion_IP = 62.84.118.249

someinternalhost_IP = 10.128.0.19

<a id="chapter-1"></a>
## Настроить доступ по SSH

Для установки соединения с someinternalhost из клиентского терминала через хост bastion используется команда:
```ssh -i ~/.ssh/ya_cloud  -J user444@62.84.118.249 user444@10.128.0.19```

Для создания алиаса, необходимо добавить в файл ~/.ssh/config:
```
Host someinternalhost
    ProxyJump user444@62.84.118.249
    HostName 10.128.0.19
    User user444
    IdentityFile ~/.ssh/ya_cloud
```
теперь можно установить соединение с someinternalhost командой:
```ssh someinternalhost```

<a id="chapter-2"></a>
## Настроить доступ через VPN

Для корректной установки и запуска сервера pritunl в файле setupvpn.sh необходимо исправить релиз с xenial на bionic для репозитория pritunl, а так же добавить установку пакета iptables.
Так же при настройке VPN сервера желательно заменить маршрут 0.0.0.0/0 на роут до локальной сети облака, в моём случае 10.128.0.0/24, для более корректной маршрутизации на стороне клиента.
Для использования валидного сертификата в web UI сервера pritunl нужно в разделе Settings, установить параметр Lets Encrypt Domain значением вида $bastion_IP.sslip.io, в моём случае 62.84.118.249.sslip.io.
И далее подключаться по домену $bastion_IP.sslip.io.

---

# Деплой тестового приложения

## Адресация

testapp_IP = 62.84.116.154

testapp_port = 9292

## Деплой приложения
Для автоматизации развёртывания приложения были созданы скрипты:
- install_ruby.sh (установка ruby)
- install_mongodb.sh (установка mongobd)
- deploy.sh (развёртывание приложения и сервера puma)
Так же создан скрипт startup.sh для автоматического создания инстанса в YC и развёртывания приложения на нём.
